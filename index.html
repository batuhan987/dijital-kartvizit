<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sigorta Haber Merkezi</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Playfair+Display:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* ... (Önceki CSS'lerin aynısı, sadece .mag-cover değişti) ... */
        :root { --primary: #0f172a; --accent: #ef4444; --paper: #fdfbf7; --text: #334155; --bg: #f1f5f9; }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--bg); color: var(--text); overflow-x: hidden; }
        nav { background: white; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
        .logo-box { display: flex; align-items: center; gap: 10px; text-decoration: none; }
        .logo-img { height: 45px; width: auto; }
        .nav-links { display: flex; gap: 25px; }
        .nav-links a { color: var(--primary); font-weight: 600; text-decoration: none; }
        .agenda-section { padding: 40px 5%; }
        .agenda-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; }
        .news-box { background: white; border-radius: 12px; padding: 25px; border-top: 5px solid; height: 350px; display: flex; flex-direction: column; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: transform 0.2s; }
        .news-box:hover { transform: translateY(-5px); }
        .box-tr { border-color: #ef4444; } .box-law { border-color: #2563eb; } .box-world { border-color: #16a34a; }
        .box-header { display: flex; gap: 10px; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px; font-weight: 800; text-transform: uppercase; }
        .news-headline { font-size: 1.3rem; font-weight: 800; color: var(--primary); margin-bottom: 10px; cursor: pointer; line-height: 1.3; }
        .newspaper-section { background: var(--paper); padding: 60px 10%; border-y: 1px solid #e2e8f0; }
        .paper-header { text-align: center; border-bottom: 3px double var(--primary); margin-bottom: 40px; }
        .paper-title { font-family: 'Playfair Display', serif; font-size: 3rem; font-weight: 900; color: var(--primary); margin: 0; }
        .paper-layout { display: flex; gap: 40px; align-items: flex-start; }
        .paper-controls { display: flex; flex-direction: column; align-items: center; gap: 15px; position: sticky; top: 120px; }
        .paper-articles { flex: 1; display: flex; flex-direction: column; gap: 30px; min-height: 400px; }
        .gazete-item { border-bottom: 1px solid #cbd5e1; padding-bottom: 25px; }
        .gazete-title { font-family: 'Playfair Display', serif; font-size: 1.8rem; font-weight: 700; color: #111827; cursor: pointer; }
        .control-btn { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--primary); background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        
        /* GÜNCELLENEN DERGİ KAPAĞI STİLİ */
        .magazine-section { padding: 60px 10%; background: #0f172a; color: white; }
        .mag-container { display: flex; gap: 50px; align-items: center; }
        .mag-cover { 
            width: 280px; min-width: 280px; height: 380px; 
            /* Varsayılan Arkaplan */
            background: linear-gradient(135deg, #ef4444, #991b1b); 
            background-size: cover; background-position: center;
            padding: 25px; transform: rotate(-3deg); 
            box-shadow: 0 20px 40px rgba(0,0,0,0.5); 
            display: flex; flex-direction: column; justify-content: space-between; 
            cursor: pointer; transition: 0.3s; 
            position: relative; overflow: hidden;
        }
        /* Kapak resmi varsa yazıları daha okunaklı yapmak için gölge */
        .mag-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.3); z-index: 1; }
        .mag-content-layer { position: relative; z-index: 2; height: 100%; display: flex; flex-direction: column; justify-content: space-between; }
        
        .mag-logo { font-family: 'Playfair Display'; font-size: 2.2rem; font-weight: 900; border-bottom: 2px solid white; padding-bottom: 10px; line-height: 0.9; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .mag-headline { font-size: 1.8rem; font-weight: 800; line-height: 1.1; margin-top: 15px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }

        footer { background: #0f172a; color: #94a3b8; padding: 50px 5%; text-align: center; border-top: 4px solid var(--accent); }
        
        /* Modal Stilleri (Aynı) */
        .reader-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 2000; overflow-y: auto; }
        .reader-content { background: white; width: 90%; max-width: 800px; margin: 50px auto; padding: 40px; border-radius: 12px; position: relative; }
        .reader-close { position: absolute; top: 20px; right: 25px; font-size: 3rem; cursor: pointer; color: #ef4444; line-height: 0.5; }
        .article-body img { max-width: 100%; height: auto; }

        @media (max-width: 768px) {
            .agenda-grid { grid-template-columns: 1fr; }
            .mag-container { flex-direction: column; }
            .mag-cover { transform: rotate(0deg); }
        }
    </style>
</head>
<body>

    <nav>
        <a href="#" class="logo-box">
            <img src="logo.png" alt="Logo" class="logo-img" onerror="this.style.display='none'">
            <span style="font-weight:900; font-size:1.4rem; color:var(--primary);">SİGORTA<span style="color:var(--accent);">HABER</span></span>
        </a>
        <div class="nav-links">
            <a href="#gundem">Gündem</a>
            <a href="#gazete">Gazete</a>
            <a href="#dergi">Dergi</a>
        </div>
    </nav>

    <div class="agenda-section" id="gundem">
        <div class="agenda-grid">
            <div class="news-box box-tr"><div class="box-header"><span style="color:#ef4444;">TR Gündem</span></div><div id="content-tr">Yükleniyor...</div></div>
            <div class="news-box box-law"><div class="box-header"><span style="color:#2563eb;">Mevzuat</span></div><div id="content-law">Yükleniyor...</div></div>
            <div class="news-box box-world"><div class="box-header"><span style="color:#16a34a;">Dünya</span></div><div id="content-world">Yükleniyor...</div></div>
        </div>
    </div>

    <div class="newspaper-section" id="gazete">
        <div class="paper-header"><h2 class="paper-title">GÜNLÜK SİGORTA</h2><small>KÖŞE YAZILARI</small></div>
        <div class="paper-layout">
            <div class="paper-controls">
                <button class="control-btn" id="btn-up" onclick="changeGazetePage(-1)">▲</button>
                <span id="page-num" style="font-weight:bold;">1</span>
                <button class="control-btn" id="btn-down" onclick="changeGazetePage(1)">▼</button>
            </div>
            <div class="paper-articles" id="gazete-container"></div>
        </div>
    </div>

    <div class="magazine-section" id="dergi">
        <div class="mag-container">
            <div class="mag-cover" id="mag-cover-el" onclick="openMagReader()">
                <div class="mag-overlay"></div> <div class="mag-content-layer">
                    <div class="mag-logo">INSUR<br>TECH</div>
                    <div id="mag-headline" class="mag-headline">DOSYA KONUSU HAZIRLANIYOR</div>
                    <div style="margin-top:auto; font-weight:bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">SAYI: 14 • 2026</div>
                </div>
            </div>
            <div>
                <h2 style="font-size:2.5rem; margin-bottom:20px;">Sektörel Bakış Dergisi</h2>
                <p id="mag-desc" style="color:#cbd5e1; font-size:1.1rem; line-height:1.6;">Yükleniyor...</p>
            </div>
        </div>
    </div>

    <footer>
        <p>Copyright © 2026. Sigorta Haber Merkezi. <br> <small>Otomatik yenileme devrede.</small></p>
    </footer>

    <div id="readerModal" class="reader-modal">
        <div class="reader-content">
            <span class="reader-close" onclick="document.getElementById('readerModal').style.display='none'">&times;</span>
            <div id="readerBody"></div>
        </div>
    </div>

    <script>
        let gazetePage = 0;
        const itemsPerPage = 5;
        let allNewsData = [];
        let magContent = {}; // Dergi içeriğini saklamak için

        document.addEventListener('DOMContentLoaded', () => {
            fetchData();
            // 5 Dakikada bir (300.000 ms) veriyi yenile
            setInterval(fetchData, 300000); 
            console.log("Otomatik yenileme aktif: 5dk");
        });

        async function fetchData() {
            try {
                // Cache-buster ile taze veri çek
                const response = await fetch('haberler.json?v=' + Date.now());
                allNewsData = await response.json();
                loadContent();
                renderGazete();
            } catch (error) { console.log("Veri çekilemedi."); }
        }

        function loadContent() {
            const tr = allNewsData.find(i => i.format === 'tr_gundem');
            const law = allNewsData.find(i => i.format === 'mevzuat');
            const world = allNewsData.find(i => i.format === 'dunya');
            const mag = allNewsData.find(i => i.format === 'dergi');

            if(tr) fillBox('content-tr', tr);
            if(law) fillBox('content-law', law);
            if(world) fillBox('content-world', world);
            
            if(mag) {
                magContent = mag; // Global değişkene at
                document.getElementById('mag-headline').innerText = mag.title;
                const tempDiv = document.createElement("div"); tempDiv.innerHTML = mag.content;
                document.getElementById('mag-desc').innerText = tempDiv.textContent.substring(0, 200) + "...";
                
                // KAPAK RESMİ AYARI
                const coverEl = document.getElementById('mag-cover-el');
                if(mag.cover && mag.cover.length > 5) {
                    // Eğer admin panelinden kapak resmi girildiyse
                    coverEl.style.backgroundImage = `url('${mag.cover}')`;
                } else {
                    // Girilmediyse varsayılan kırmızı degrade
                    coverEl.style.backgroundImage = 'linear-gradient(135deg, #ef4444, #991b1b)';
                }
            }
        }

        function fillBox(id, item) {
            document.getElementById(id).innerHTML = `
                <h2 style="cursor:pointer" onclick='openReader("${item.title.replace(/"/g, '&quot;')}", ${JSON.stringify(item.content)})'>${item.title}</h2>
                <small>${item.date}</small>`;
        }

        function renderGazete() {
            const list = allNewsData.filter(i => i.format === 'gazete');
            const container = document.getElementById('gazete-container');
            if(list.length === 0) { container.innerHTML = "Yazı yok."; return; }

            const start = gazetePage * itemsPerPage;
            const items = list.slice(start, start + itemsPerPage);

            container.innerHTML = "";
            items.forEach(item => {
                const tempDiv = document.createElement("div"); tempDiv.innerHTML = item.content;
                const txt = tempDiv.textContent.substring(0, 200);
                container.innerHTML += `
                    <div class="gazete-item">
                        <h3 class="gazete-title" onclick='openReader("${item.title.replace(/"/g, '&quot;')}", ${JSON.stringify(item.content)})'>${item.title}</h3>
                        <div class="gazete-text">${txt}...</div>
                    </div>`;
            });
        }

        function changeGazetePage(dir) {
            gazetePage += dir; renderGazete();
        }

        function openReader(title, content) {
            document.getElementById('readerBody').innerHTML = `<h1>${title}</h1><div>${content}</div>`;
            document.getElementById('readerModal').style.display = 'block';
        }
        
        function openMagReader() {
            if(magContent.title) openReader(magContent.title, magContent.content);
        }
    </script>
</body>
</html>
